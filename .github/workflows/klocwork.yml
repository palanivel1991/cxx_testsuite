name: Run Klocwork kwcheck CLI (No Login Needed)

on:
  workflow_dispatch:

jobs:
  run-kwcheck:
    runs-on: self-hosted

    steps:
      - name: Checkout your repo
        uses: actions/checkout@v4

      - name: Create .ltoken file with token
        run: |
          $token = "d255d588c7e9959b28761db8d5ff4a87b04e01f8eec411a745540ac732c24530"
          $ltokenEntry = "192.168.0.127;8082;admin;$token"
          $ltokenPath = "$Env:USERPROFILE\.klocwork\ltoken"
          New-Item -Path $(Split-Path $ltokenPath) -ItemType Directory -Force
          Set-Content -Path $ltokenPath -Value $ltokenEntry

      - name: Run Klocwork kwcheck
        run: |
          D:\kw_cmd_24.4\bin\kwcheck create --url http://192.168.0.127:8082/Demo --project-dir kwps
          D:\kw_cmd_24.4\bin\kwcheck run --url http://192.168.0.127:8082/Demo --project-dir kwps
